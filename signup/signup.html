<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Club Signup</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
  const link = document.createElement('link');
  link.rel = 'icon';
  link.href = 'logo.svg'; 
  document.getElementsByTagName('head')[0].appendChild(link);
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>

<style>
  @font-face { font-family: 'Phantom Sans'; src: url('https://assets.hackclub.com/fonts/Phantom_Sans_0.7/Regular.woff') format('woff'); }
  
  :root { --primary: #2d7ff9; --white: #ffffff; }
  #canvas-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: auto;
}

#three-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1; 
  pointer-events: none;
}

  body {
    font-family: 'Phantom Sans', sans-serif;
    margin: 0; padding: 0;
    height: 100vh;
    overflow: hidden;
    background: transparent;
    overflow-y: auto;  
    display: flex; justify-content: center; align-items: center;
  }
html { background: #000080; }
 #regForm h1, 
#regForm p, 
#regForm label, 
#regForm strong { 
  color: #ffffff !important; 
}

#regForm p { 
  opacity: 0.9; 
}

#thankYou div {
  background: rgba(253, 224, 71, 0.15) !important;
  color: #ffffff !important;
  border: 2px solid #FDE047 !important;
  box-shadow: 0 0 15px rgba(253, 224, 71, 0.2);
}

  /* Form Card */
  #regForm { 
    background: rgba(255, 255, 255, 0.05); 
    backdrop-filter: blur(16px); 
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.1); 
    border-radius: 30px;
    padding: 40px; 
    width: 90%; 
    max-width: 500px; 
    position: relative; 
    min-height: 450px; 
    display: flex; 
    flex-direction: column; 
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  #regForm:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(253, 224, 71, 0.4);
  }

  h1 { text-align: center; color: var(--primary); margin-top: 0; }

  .logo { 
    display: block; margin: 0 auto 25px; max-height: 80px; max-width: 80%; width: auto; 
    object-fit: contain; border-radius: 15px; cursor: grab; user-select: none; -webkit-user-drag: none;
    transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1), filter 0.3s ease;
  }

  .logo.is-pulling { cursor: grabbing; filter: opacity(0.6) blur(2px); background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px); }

  input { padding: 15px; width: 100%; font-size: 17px; font-family: 'Phantom Sans'; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; transition: 0.3s; }
  input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 8px rgba(45, 127, 249, 0.2); }
  input.invalid { border-color: #ff4d4d; background-color: #fff8f8; }
  .error-msg { color: #ff4d4d; font-size: 13px; display: none; margin-bottom: 15px; margin-top: -5px; font-weight: bold; }

  .btn-group { display: flex; justify-content: space-between; margin-top: auto; padding-top: 20px; gap: 15px; }

  button {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 14px 28px;
  font-size: 16px;
  font-weight: 800;
  border-radius: 14px;
  cursor: pointer;
  font-family: 'Phantom Sans';
  transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1.2);
  text-transform: uppercase;
}

button:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: #FDE047;
  transform: scale(1.05);
}

button:active {
  transform: scale(0.92);
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(25px);
  border-color: rgba(253, 224, 71, 0.8);
  transition: all 0.1s ease;
}

  .home-btn {
    position: absolute; top: 15px; left: 15px; width: 45px; height: 45px;
    border-radius: 50% !important; padding: 0 !important; display: flex;
    justify-content: center; align-items: center; z-index: 100;
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px);
  }
  .home-btn svg { width: 22px; height: 22px; fill: white; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5)); }

  .tab { display: none; animation: fadeEffect 0.6s; flex-grow: 1; }
  @keyframes fadeEffect { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .iti { width: 100%; margin-bottom: 10px; }
</style>
</head>
<body>
  <div id="canvas-container"></div>
  <canvas id="three-canvas"></canvas>
  
<form id="regForm" action="">
  <button type="button" class="home-btn" onclick="window.location.href='../index.html'">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  </button>

  <img src="logo.svg" alt="Club Logo" class="logo" title="Double click to go home">

  <div class="tab">
    <h1>Welcome!</h1>
    <p style="text-align:center;">Let's get you signed up.</p>
    <input type="text" placeholder="First Name" name="fname" oninput="this.className = ''">
    <input type="text" placeholder="Last Name" name="lname" oninput="this.className = ''">
  </div>

  <div class="tab">
    <h1>Contact Info</h1>
    <input type="tel" id="phone" name="phone_raw">
    <span class="error-msg" id="phone-error">Please enter a valid phone number.</span>
    <input type="email" placeholder="Email Address" name="email" oninput="this.className = ''">
    <span class="error-msg" id="email-error">Invalid email format</span>
    <label style="display:block; margin-top: 15px; margin-bottom: 5px; color: #666;">Date of Birth (13-18 only)</label>
    <input type="date" name="dob" id="dob">
    <span class="error-msg" id="age-error">Aged 13â€“18 only.</span>
  </div>

  <div class="tab">
    <h1>Emergency Contact 1</h1>
    <input type="text" placeholder="Guardian First Name" name="ec1_fname">
    <input type="text" placeholder="Guardian Last Name" name="ec1_lname">
    <input type="tel" id="ec1_phone" name="ec1_phone_raw">
    <input type="email" placeholder="Guardian Email" name="ec1_email">
  </div>

  <div class="tab">
    <h1>Emergency Contact 2</h1>
    <input type="text" placeholder="First Name (Optional)" name="ec2_fname">
    <input type="text" placeholder="Last Name (Optional)" name="ec2_lname">
    <input type="tel" id="ec2_phone" name="ec2_phone_raw">
    <input type="email" placeholder="Email (Optional)" name="ec2_email">
  </div>

  <div class="tab" id="thankYou" style="text-align: center;">
    <h1>All set!</h1>
    <p>We'll be in touch soon!</p>
    <div style="background: #eef2ff; padding: 15px; border-radius: 10px; margin-top: 30px; border: 2px dashed var(--primary);">
        <strong>Important:</strong> Bring ID to the first meeting.<br>Opening Feb 7th, 2026! ðŸŽ‰
    </div>
  </div>

  <div class="btn-group" id="btnDiv">
    <button type="button" id="prevBtn" onclick="nextPrev(-1)">Back</button>
    <button type="button" id="nextBtn" onclick="nextPrev(1)">Next Step</button>
  </div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script>
// --- 3D SCENE SCRIPT ---
let scene, camera, renderer, shape, stars;
let isThreeDragging = false; // Renamed to avoid conflict

function init3D() {
  const canvas = document.getElementById('three-canvas');
  if (!canvas) return;
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  const geometry = new THREE.DodecahedronGeometry(15, 0); 
  const material = new THREE.MeshNormalMaterial({ wireframe: true, transparent: true, opacity: 0.7 });
  shape = new THREE.Mesh(geometry, material);
  scene.add(shape);
  const starCount = 1000;
  const starGeo = new THREE.BufferGeometry();
  const positions = new Float32Array(starCount * 3);
  for (let i = 0; i < starCount * 3; i++) { positions[i] = (Math.random() - 0.5) * 300; }
  starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xFDE047, size: 0.6 }));
  scene.add(stars);
  camera.position.z = 50;

  const onMove = (e) => {
    if (!isThreeDragging || !shape) return;
    const pos = e.touches ? e.touches[0] : e;
    const vector = new THREE.Vector3((pos.clientX / window.innerWidth) * 2 - 1, -(pos.clientY / window.innerHeight) * 2 + 1, 0.5);
    vector.unproject(camera);
    const dir = vector.sub(camera.position).normalize();
    const distance = -camera.position.z / dir.z;
    const newPos = camera.position.clone().add(dir.multiplyScalar(distance));
    shape.position.set(newPos.x, newPos.y, 0);
  };

  window.addEventListener('mousedown', () => { isThreeDragging = true; });
  window.addEventListener('mouseup', () => { isThreeDragging = false; });
  window.addEventListener('mousemove', onMove);
  window.addEventListener('touchstart', () => { isThreeDragging = true; });
  window.addEventListener('touchend', () => { isThreeDragging = false; });
  window.addEventListener('touchmove', onMove);
  window.addEventListener('mousedown', (e) => { 
  if (e.target.id === 'three-canvas') isThreeDragging = true; 
});




  function animate() {
    requestAnimationFrame(animate);
    if (!isThreeDragging) { shape.rotation.x += 0.005; shape.rotation.y += 0.008; }
    stars.rotation.y += 0.0003;
    renderer.render(scene, camera);
  }
  animate();
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

// --- FORM LOGIC ---
let currentTab = 0;
window.onload = () => {
  init3D();
  showTab(currentTab);
};

const phoneOpts = { utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js", separateDialCode: true };
const phoneInput = window.intlTelInput(document.querySelector("#phone"), phoneOpts);
const ec1PhoneInput = window.intlTelInput(document.querySelector("#ec1_phone"), phoneOpts);
const ec2PhoneInput = window.intlTelInput(document.querySelector("#ec2_phone"), phoneOpts);

function showTab(n) {
  let x = document.getElementsByClassName("tab");
  x[n].style.display = "flex";
  x[n].style.flexDirection = "column";
  document.getElementById("prevBtn").style.visibility = (n == 0) ? "hidden" : "visible";
  if (n == (x.length - 2)) document.getElementById("nextBtn").innerHTML = "Submit Signup";
  else document.getElementById("nextBtn").innerHTML = "Next Step";
  if (n == x.length - 1) document.getElementById("btnDiv").style.display = "none";
}

function nextPrev(n) {
  let x = document.getElementsByClassName("tab");
  if (n == 1 && !validateForm()) return false;
  x[currentTab].style.display = "none";
  currentTab = currentTab + n;
  if (currentTab >= x.length - 1) submitForm();
  showTab(currentTab);
}

function initHaptics() {
    const btns = document.querySelectorAll('button');
    btns.forEach(btn => {
        const press = () => btn.style.setProperty('--press', '1');
        const release = () => btn.style.setProperty('--press', '0');
        btn.addEventListener('mousedown', press);
        btn.addEventListener('mouseup', release);
        btn.addEventListener('mouseleave', release);
        btn.addEventListener('touchstart', press, {passive: true});
        btn.addEventListener('touchend', release);
    });
}
initHaptics();

function validateForm() {
  let valid = true;
  let x = document.getElementsByClassName("tab");
  let inputs = x[currentTab].querySelectorAll("input");
  
  if (currentTab < 3) {
    for (let i = 0; i < inputs.length; i++) {
      if (inputs[i].value.trim() === "") {
        inputs[i].classList.add("invalid");
        valid = false;
      } else {
        inputs[i].classList.remove("invalid");
      }
    }

    if (currentTab === 1) {
      const emailInput = document.querySelector('input[name="email"]');
      const emailError = document.getElementById("email-error");
      const phoneError = document.getElementById("phone-error");
      const ageError = document.getElementById("age-error");
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const isEmailValid = emailRegex.test(emailInput.value);
      const isPhoneValid = phoneInput.isValidNumber();
      const dobValue = document.getElementById("dob").value;
      let isAgeValid = false;
      if (dobValue) {
        const birthDate = new Date(dobValue);
        const age = Math.floor((new Date() - birthDate) / 31557600000);
        isAgeValid = (age >= 13 && age <= 18);
      }
      emailError.style.display = isEmailValid ? "none" : "block";
      phoneError.style.display = isPhoneValid ? "none" : "block";
      ageError.style.display = isAgeValid ? "none" : "block";
      if (!isEmailValid || !isPhoneValid || !isAgeValid) valid = false;
    }
    
    if (currentTab === 2) {
      if (!ec1PhoneInput.isValidNumber()) {
        document.querySelector("#ec1_phone").classList.add("invalid");
        valid = false;
      } else {
        document.querySelector("#ec1_phone").classList.remove("invalid");
      }
    }
  }
  return valid;
}

function submitForm() {
  const formData = new FormData(document.getElementById("regForm"));
  formData.set('phone_final', phoneInput.getNumber());
  fetch('https://formspree.io/f/mykkwgyl', { method: 'POST', body: formData, headers: { 'Accept': 'application/json' } });
}

// LOGO PHYSICS
const logo = document.querySelector('.logo');
let isLogoDragging = false; // Renamed to avoid conflict
let startX, startY;

logo.addEventListener('dblclick', () => { window.location.href = '../index.html'; });

const startDrag = (e) => {
  isLogoDragging = true;
  logo.classList.add('is-pulling');
  const pos = e.touches ? e.touches[0] : e;
  startX = pos.clientX; startY = pos.clientY;
  const startDrag = (e) => {
  e.stopPropagation(); // Stops background from moving
  isLogoDragging = true;
  // ... rest of code
};
};

const doDrag = (e) => {
  if (!isLogoDragging) return;
  const pos = e.touches ? e.touches[0] : e;
  const moveX = (pos.clientX - startX) / 3;
  const moveY = (pos.clientY - startY) / 3;
  logo.style.transform = `translate(${moveX}px, ${moveY}px) scale(1.1)`;
};

const stopDrag = () => {
  isLogoDragging = false;
  logo.classList.remove('is-pulling');
  logo.style.transform = `translate(0px, 0px) scale(1)`;
};

logo.addEventListener('mousedown', startDrag);
window.addEventListener('mousemove', doDrag);
window.addEventListener('mouseup', stopDrag);
logo.addEventListener('touchstart', startDrag, {passive: true});
window.addEventListener('touchmove', doDrag, {passive: false});
window.addEventListener('touchend', stopDrag);


document.addEventListener('keydown', (e) => {
  if (e.key.toLowerCase() === 'd') {
    let x = document.getElementsByClassName("tab");
    x[currentTab].style.display = "none";
    currentTab = (currentTab + 1) % x.length;
    showTab(currentTab);
  }
});



document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', () => {
    if (navigator.vibrate) {
      navigator.vibrate(75); // Haptic for Android
    }
  });
});

</script>
</body>
</html>

